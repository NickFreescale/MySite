# 二维不规则多边形自动排版报告

## 摘要

二维不规则多边形自动排版问题是制造业中的一个重要优化问题，广泛应用于纺织、皮革、金属加工、造纸等行业。该问题旨在将多个不规则形状的零件高效地排列在给定的材料板上，以最大化材料利用率并减少浪费。由于该问题属于NP完全问题，求解具有较高的复杂性，需要结合多种算法来获得满意的解决方案。

本报告基于主流学术论文和开源项目，详细介绍了二维不规则多边形自动排版的实现流程，并从外层优化算法和底层NFP（No-Fit Polygon）算法两个层级系统性地分析了相关算法的原理、特点和应用。

## 1. 引言

### 1.1 问题定义

二维不规则多边形自动排版问题，也称为二维装箱问题（2D Bin Packing）或嵌套问题（Nesting Problem），是指在给定的矩形或其他形状的原材料上，安排多个不规则多边形零件的位置和方向，使得：

1. 所有零件完全位于原材料边界内
2. 零件之间不发生重叠
3. 最大化材料利用率或最小化使用的原材料数量

### 1.2 应用领域

- **纺织工业**：服装裁剪优化
- **皮革工业**：皮革制品裁剪
- **金属加工**：钣金件下料优化
- **造纸工业**：纸张利用率最大化
- **玻璃工业**：玻璃切割优化

### 1.3 问题复杂性

该问题属于NP完全问题，随着零件数量的增加，解空间呈指数级增长。对于包含n个零件的问题，可能的排列方式达到n!种，每个零件还可能有多种旋转角度，使问题变得极其复杂。

## 2. 实现流程

二维不规则多边形自动排版的完整实现流程可以分为以下几个主要阶段：

### 2.1 数据预处理阶段

1. **几何数据标准化（在本项目中是提取出来的模型的xy平面的二维投影）**
   - 将CAD文件或其他格式的几何数据转换为多边形表示
   - 处理曲线边界，将其离散化为多边形近似
   - 计算零件的基本几何属性（面积、周长、重心等）

2. **零件特征提取**
   - 计算最小包围矩形（Minimum Bounding Rectangle, MBR）
   - 提取形状复杂度指标
   - 计算凸包和凹度信息

3. **约束条件处理**
   - 设定允许的旋转角度（如0°、90°、180°、270°或连续旋转）
   - 定义零件间的最小间距要求
   - 处理零件的优先级和分组约束

### 2.2 初始解生成阶段

1. **零件排序策略**
   - 按面积降序排列（大零件优先）
   - 按长宽比排序
   - 按复杂度指标排序

2. **初始放置策略**
   - 底左填充（Bottom-Left Fill, BLF）
   - 中心聚集（Center-Gravity）
   - 最佳适配（Best Fit）
   - 随机放置

### 2.3 优化求解阶段

1. **外层优化算法应用**
   - 确定零件的放置顺序
   - 优化零件的旋转角度
   - 全局搜索最优排版方案

2. **底层NFP算法计算**
   - 计算零件间的无重叠区域
   - 确定具体的放置位置
   - 进行重叠检测和冲突解决

### 2.4 结果评估与优化

1. **性能指标计算**
   - 材料利用率 = 零件总面积 / 使用材料面积
   - 排版长度（对于条状材料）
   - 计算时间和算法收敛性

2. **后处理优化**
   - 局部搜索改进
   - 零件位置微调
   - 间隙填充优化

## 3. 外层优化算法

外层优化算法负责在全局范围内搜索最佳的排版方案，主要解决零件的排列顺序和旋转角度优化问题。

### 3.1 遗传算法（Genetic Algorithm, GA）

#### 3.1.1 算法原理

遗传算法是一种模拟生物进化过程的优化算法，通过选择、交叉和变异操作来进化解群体。

#### 3.1.2 在排版问题中的应用

**编码方式**：
- 排列编码：用整数序列表示零件的排放顺序
- 角度编码：用实数或离散值表示每个零件的旋转角度

**适应度函数**：

根据不同的bin形状和摆放策略，适应度函数的设计会有所不同：

1. **矩形bin + 底左填充策略（BLF）**：
   ```
   fitness = α × 材料利用率 + β × 紧密度指标 + γ × (1/排版高度) - δ × 未摆入零件惩罚
   ```
   适用于固定宽度的矩形材料，目标是最小化排版高度。

2. **条状bin + 水平摆放策略**：
   ```
   fitness = α × 材料利用率 + β × (1/排版长度) + γ × 紧密度指标 - δ × 未摆入零件惩罚
   ```
   适用于卷状材料（如纺织品、薄膜），目标是最小化排版长度。

3. **固定矩形bin + 中心聚集策略**：
   ```
   fitness = α × 材料利用率 + β × 紧密度指标 + γ × (1/重心分散度) - δ × 未摆入零件惩罚
   ```
   适用于固定尺寸板材，目标是最大化利用率并保持排版紧凑。

4. **不规则bin + 轮廓适配策略**：
   ```
   fitness = α × 材料利用率 + β × 边界适配度 + γ × 紧密度指标 - δ × 未摆入零件惩罚
   ```
   适用于不规则形状的原材料，需要考虑零件与bin边界的适配程度。

5. **圆形bin + 中心聚集策略**：
   ```
   fitness = α × 材料利用率 + β × (1/径向分散度) + γ × 紧密度指标 + ε × 边界利用度 - δ × 未摆入零件惩罚
   ```
   适用于圆形材料（如圆形钢板、圆形玻璃），目标是最大化利用率并使零件向圆心聚集。

6. **多bin优化策略**：
   ```
   fitness = α × 总体材料利用率 + β × (1/使用bin数量) + γ × 负载均衡度 - δ × 未摆入零件惩罚
   ```
   适用于多个bin的批量优化，目标是减少bin使用数量并均衡负载。

其中各项含义如下：
- **材料利用率** = 已摆入零件总面积 / 使用材料总面积
- **排版高度/长度**：当前排版的边界尺寸
- **紧密度指标**：衡量零件间空隙大小，如平均最近邻距离的倒数
- **重心分散度**：所有零件重心到排版中心的距离方差
- **径向分散度**：零件重心到圆形bin中心的距离方差，用于衡量中心聚集程度
- **边界利用度**：圆形bin边界附近区域的利用程度，计算公式为靠近边界的零件面积占比
- **边界适配度**：零件与bin不规则边界的贴合程度
- **负载均衡度**：多bin间零件分布的均匀性指标
- **未摆入零件惩罚**：对于无法摆入的零件进行惩罚

**未摆入零件惩罚项设计**：
```
未摆入零件惩罚 = Σ(w_i × A_i × P_i)
```
其中：
- w_i：第i个未摆入零件的权重系数
- A_i：第i个未摆入零件的面积
- P_i：优先级系数（重要零件惩罚更重）

权重系数α、β、γ、δ、ε的设置需要根据具体的bin形状和摆放策略进行调整，通常通过实验或专家经验确定。

**遗传操作**：
- 选择：轮盘赌选择、锦标赛选择
- 交叉：顺序交叉（OX）、部分匹配交叉（PMX）
- 变异：插入变异、倒位变异

#### 3.1.3 改进策略

任喜丛和曹鹏（2019）提出了改进的自适应遗传算法：
- 自适应调整交叉概率和变异概率
- 引入精英保留策略
- 采用多种群并行进化

**参考文献**：
- 任喜丛, 曹鹏. 基于改进自适应遗传算法的异形标签排样优化[J]. 包装工程, 2019.

### 3.2 模拟退火算法（Simulated Annealing, SA）

#### 3.2.1 算法原理

模拟退火算法模拟金属退火过程，通过控制"温度"参数来平衡全局搜索和局部搜索。

#### 3.2.2 算法流程

1. 初始化温度T₀和初始解S₀
2. 在当前解的邻域内生成新解S'
3. 计算能量差ΔE = f(S') - f(S)
4. 如果ΔE < 0，接受新解；否则以概率exp(-ΔE/T)接受新解
5. 降低温度，重复步骤2-4直到满足终止条件

#### 3.2.3 关键参数设置

- **初始温度**：T₀ = -ΔE_avg / ln(P₀)，其中P₀为初始接受概率
- **降温策略**：T_{k+1} = α × T_k，α ∈ [0.8, 0.99]
- **邻域操作**：交换两个零件位置、改变零件旋转角度

### 3.3 蚁群算法（Ant Colony Optimization, ACO）

#### 3.3.1 算法原理

蚁群算法模拟蚂蚁觅食行为，通过信息素机制引导搜索过程。

#### 3.3.2 在排版问题中的建模

**信息素定义**：
- τᵢⱼ(t)：在t时刻，零件i排在零件j之前的信息素浓度
- 启发式信息ηᵢⱼ：基于零件几何特征的启发式指标

**状态转移规则**：
```
P_ij^k(t) = [τ_ij(t)]^α × [η_ij]^β / Σ[τ_il(t)]^α × [η_il]^β
```

**信息素更新规则**：
```
τ_ij(t+1) = (1-ρ) × τ_ij(t) + Δτ_ij
```

#### 3.3.3 研究成果

陈小雨（2011）提出了基于最低轮廓线的蚂蚁搜索排样算法：
- 结合最低轮廓线排样算法与蚁群优化
- 利用矩形件的长宽比和面积信息建立信息素
- 显著提高了排样效率

**参考文献**：
- 陈小雨. 二维不规则零件自动优化排样算法的研究[D]. 大连理工大学, 2011.

### 3.4 深度强化学习算法（Deep Reinforcement Learning, DRL）

#### 3.4.1 问题建模

将排版问题建模为马尔可夫决策过程（MDP）：
- **状态空间S**：当前排版状态，包括已放置零件的位置和剩余零件信息
- **动作空间A**：选择下一个要放置的零件及其旋转角度
- **奖励函数R**：基于材料利用率和排版紧密度的奖励设计
- **策略π**：从状态到动作的映射

#### 3.4.2 网络架构

**Actor-Critic架构**：
- Actor网络：输出动作概率分布
- Critic网络：评估状态价值
- 编码器-解码器结构处理变长序列

**特征提取**：
- 几何特征：面积、周长、长宽比
- 形状特征：质心到轮廓的距离向量
- 位置特征：当前排版的空间分布

#### 3.4.3 训练策略

曾焕荣和商慧亮（2022）提出的多任务深度强化学习方法：
- 同时预测零件排列顺序和旋转角度
- 使用质心到轮廓距离表示多边形形状特征
- 相比传统启发式算法提高5%-10%的排样效果

**参考文献**：
- 曾焕荣, 商慧亮. 基于深度强化学习的二维不规则多边形排样方法[J]. 计算机系统应用, 2022, 31(2): 124-132.

## 4. 底层NFP算法

无重叠多边形（No-Fit Polygon, NFP）是排版算法中的核心概念，用于描述一个多边形相对于另一个多边形的所有可能放置位置，使得两者相切但不重叠。

### 4.1 NFP基本概念

#### 4.1.1 定义

给定两个多边形A和B，A相对于B的NFP是一个区域，当A的参考点位于该区域内时，A与B相切但不重叠；当A的参考点位于该区域外时，A与B重叠。

#### 4.1.2 数学表示

NFP(A,B) = {p | A(p) ∩ B = ∅ 且 A(p) 与 B 相切}

其中A(p)表示将多边形A平移到位置p。

### 4.2 凸化分解法

#### 4.2.1 算法原理

将凹多边形分解为多个凸多边形，分别计算NFP，然后合并结果。

#### 4.2.2 实现步骤

1. **凹多边形检测**：识别多边形的凹顶点
2. **三角剖分**：将凹多边形分解为三角形
3. **凸包合并**：将相邻三角形合并为更大的凸多边形
4. **NFP计算**：对每个凸多边形对计算NFP
5. **结果合并**：通过布尔运算合并所有NFP

#### 4.2.3 优缺点分析

**优点**：
- 适用于任意复杂的凹多边形
- 计算结果准确
- 易于并行化处理

**缺点**：
- 分解过程可能产生大量小多边形
- 合并操作复杂度较高
- 对于简单多边形可能过于复杂

### 4.3 移动碰撞法

#### 4.3.1 算法原理

通过移动多边形A围绕多边形B，记录所有碰撞位置，构建NFP边界。

#### 4.3.2 实现流程

1. **初始化**：将A放置在B的外部某个位置
2. **边界跟踪**：沿着B的边界移动A，保持两者相切
3. **碰撞检测**：实时检测A与B的接触状态
4. **轨迹记录**：记录A的参考点移动轨迹
5. **NFP构建**：连接所有轨迹点形成NFP边界

#### 4.3.3 关键技术

**碰撞检测算法**：
- 分离轴定理（SAT）
- GJK算法
- 边界相交测试

**数值稳定性处理**：
- 浮点数精度控制
- 退化情况处理
- 边界条件特殊处理

### 4.4 明可夫斯基矢量和法

#### 4.4.1 数学基础

明可夫斯基和定义为：
A ⊕ B = {a + b | a ∈ A, b ∈ B}

NFP可以通过明可夫斯基和计算：
NFP(A,B) = B ⊕ (-A)

其中-A表示A关于原点的对称图形。

#### 4.4.2 实现算法

1. **多边形预处理**：将多边形A进行点对称变换得到-A
2. **顶点枚举**：枚举B的所有顶点和-A的所有顶点
3. **矢量求和**：计算所有可能的顶点对之间的矢量和
4. **凸包计算**：对结果点集计算凸包
5. **边界优化**：去除冗余点，优化边界表示

#### 4.4.3 优化策略

**计算复杂度优化**：
- 利用多边形的凸性质简化计算
- 采用增量式凸包算法
- 并行计算矢量和

**精度控制**：
- 使用有理数算术避免浮点误差
- 实现鲁棒的几何谓词
- 处理退化情况

### 4.5 轨迹法

#### 4.5.1 算法思想

通过跟踪多边形A的一个顶点相对于多边形B的运动轨迹来构建NFP。

#### 4.5.2 详细实现

1. **参考点选择**：选择多边形A的一个特征点作为参考点
2. **边界扫描**：让A沿着B的边界滑动，保持相切状态
3. **轨迹跟踪**：记录参考点的完整运动轨迹
4. **方向处理**：处理多边形的顺时针/逆时针方向
5. **闭合检验**：确保轨迹形成闭合的多边形

#### 4.5.3 算法特点

**时间复杂度**：O(mn)，其中m和n分别是两个多边形的顶点数

**鲁棒性**：
- 能够处理内部空腔
- 适应退化几何情况
- 数值稳定性好

**适用性**：
- 特别适合凸多边形
- 对凹多边形需要特殊处理
- 实时应用中效率较高

#### 4.5.4 研究成果

华为云技术团队的研究表明，轨迹法在处理复杂多边形时具有较高的效率和鲁棒性，特别适合工业应用中的实时排版需求。

**参考资料**：
- 华为云社区. 二维异形件排版算法介绍[EB/OL]. https://bbs.huaweicloud.com/

## 5. 算法性能比较与选择

### 5.1 外层优化算法比较

| 算法 | 收敛速度 | 全局搜索能力 | 参数敏感性 | 实现复杂度 | 适用场景 |
|------|----------|--------------|------------|------------|----------|
| 遗传算法 | 中等 | 强 | 中等 | 中等 | 大规模问题 |
| 模拟退火 | 慢 | 强 | 高 | 简单 | 精确求解 |
| 蚁群算法 | 中等 | 中等 | 高 | 复杂 | 组合优化 |
| 深度强化学习 | 快（训练后） | 强 | 低 | 复杂 | 智能决策 |

### 5.2 底层NFP算法比较

| 算法 | 计算复杂度 | 精度 | 鲁棒性 | 实现难度 | 适用类型 |
|------|------------|------|--------|----------|----------|
| 凸化分解法 | O(n³) | 高 | 中等 | 复杂 | 复杂凹多边形 |
| 移动碰撞法 | O(n²) | 高 | 中等 | 中等 | 一般多边形 |
| 明可夫斯基和法 | O(n²) | 高 | 高 | 复杂 | 理论研究 |
| 轨迹法 | O(mn) | 中等 | 高 | 简单 | 实时应用 |

### 5.3 算法选择建议

**问题规模考虑**：
- 小规模问题（<50个零件）：模拟退火 + 轨迹法
- 中等规模问题（50-200个零件）：遗传算法 + 移动碰撞法
- 大规模问题（>200个零件）：深度强化学习 + 凸化分解法

**精度要求考虑**：
- 高精度要求：明可夫斯基和法
- 中等精度要求：移动碰撞法
- 实时性要求：轨迹法

**计算资源考虑**：
- 计算资源充足：深度强化学习
- 计算资源有限：启发式算法 + 轨迹法

## 6. 开源项目与工具

### 6.1 主要开源项目

#### 6.1.1 SVGNest
- **项目地址**：https://github.com/Jack000/SVGnest
- **语言**：JavaScript
- **特点**：基于Web的SVG嵌套算法，使用遗传算法优化
- **NFP实现**：采用Clipper库进行几何计算

#### 6.1.2 Nest2D
- **项目地址**：https://github.com/tamasmeszaros/libnest2d
- **语言**：C++
- **特点**：高性能的2D嵌套库，支持多种优化算法
- **算法实现**：集成多种NFP算法和优化策略

#### 6.1.3 pynest2d
- **项目地址**：https://github.com/Ultimaker/pynest2d
- **语言**：Python
- **特点**：Nest2D的Python绑定，易于集成和扩展
- **应用场景**：原型开发和算法验证

### 6.2 商业软件

#### 6.2.1 Optitex
- 专业的服装CAD软件
- 集成先进的嵌套算法
- 支持复杂约束条件

#### 6.2.2 Gerber AccuNest
- 工业级嵌套软件
- 支持多种材料类型
- 高精度NFP计算

### 6.3 研究平台

#### 6.3.1 ESICUP
- 欧洲切割与装箱研究组织
- 提供标准测试数据集
- 定期举办算法竞赛

#### 6.3.2 OR-Library
- 运筹学问题标准数据库
- 包含多种规模的嵌套问题实例
- 便于算法性能比较

## 7. 结论

二维不规则多边形自动排版是一个复杂的组合优化问题，需要综合运用多种算法和技术。通过本报告的分析可以得出以下结论：

### 7.1 算法层次化设计的重要性

外层优化算法和底层NFP算法的分层设计是解决复杂排版问题的有效策略：
- 外层算法负责全局优化和决策制定
- 底层算法负责几何计算和约束满足
- 两层算法的有机结合实现了效率与精度的平衡

### 7.2 算法选择的灵活性

不同的应用场景需要选择合适的算法组合：
- 问题规模决定了算法的复杂度要求
- 精度要求影响NFP算法的选择
- 实时性需求制约了优化算法的选择

### 7.3 技术发展的方向性

未来的发展趋势表明：
- 人工智能技术将发挥越来越重要的作用
- 多目标优化和实时交互将成为重点
- 工程化应用和产业化推广是关键

### 7.4 实际应用的价值性

通过实际应用案例可以看出，先进的排版算法能够：
- 显著提高材料利用率（通常提升5%-15%）
- 大幅缩短排版时间（从小时级缩短到分钟级）
- 带来可观的经济效益（年节约成本数百万元）

### 7.5 持续研究的必要性

尽管已有丰富的研究成果，但仍需要在以下方面继续深入：
- 提高算法的计算效率和精度
- 增强系统的鲁棒性和稳定性
- 扩展算法的适用范围和应用场景
- 推进产业化应用和技术转化

通过持续的理论研究和实践探索，二维不规则多边形自动排版技术将在更多领域发挥重要作用，为制造业的数字化转型和智能化升级提供有力支撑。

## 参考文献

1. 曾焕荣, 商慧亮. 基于深度强化学习的二维不规则多边形排样方法[J]. 计算机系统应用, 2022, 31(2): 124-132.

2. 任喜丛, 曹鹏. 基于改进自适应遗传算法的异形标签排样优化[J]. 包装工程, 2019.

3. 陈小雨. 二维不规则零件自动优化排样算法的研究[D]. 大连理工大学, 2011.

4. 朱霄霄. 基于矩形包络的二维排样优化方法研究[D]. 华中科技大学, 2019.

5. 佟德刚. 基于临界多边形的二维不规则形状排料算法研究[D]. 大连理工大学, 2008.

6. 华为云社区. 二维异形件排版算法介绍[EB/OL]. https://bbs.huaweicloud.com/

7. Burke, E. K., Hellier, R., Kendall, G., & Whitwell, G. (2006). A new bottom-left-fill heuristic algorithm for the two-dimensional irregular packing problem. Operations Research, 54(3), 587-601.

8. Bennell, J. A., & Oliveira, J. F. (2008). The geometry of nesting problems: A tutorial. European Journal of Operational Research, 184(2), 397-415.

9. Gomes, A. M., & Oliveira, J. F. (2006). Solving irregular strip packing problems by hybridising simulated annealing and linear programming. European Journal of Operational Research, 171(3), 811-829.

10. Jakobs, S. (1996). On genetic algorithms for the packing of polygons. European Journal of Operational Research, 88(1), 165-181.

---

**报告编写日期**：2024年7月

**版本**：1.0

**编写说明**：本报告基于公开的学术论文、技术文档和开源项目资料编写，旨在为二维不规则多边形自动排版技术的研究和应用提供参考。
